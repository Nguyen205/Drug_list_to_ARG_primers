# Drug_list_to_ARG_primers
Metagenomic sequencing results can guide the design of qPCR primers and probes. This is a pipeline for designing qPCR primers and probes targeting the ARGs of interest based on metagenomic sequencing results and a list of antibiotics of interest. 

## Description
Metagenomic sequencing and qPCR are two mainstream methods for detecting antibiotic resistance genes (ARGs) in complex DNA samples (e.g., wastewater, stool, etc.). Metagenomic sequencing can detect a wide range of ARGs without targeting them, while qPCR requires primer and probe design for each ARG. However, metagenomic sequencing is more expensive, harder to perform, and less sensitive than qPCR. Therefore, for routine ARG surveillance, it is more practical to use metagenomic sequencing at the beginning to determine the range of target ARGs and design qPCR primers and probes accordingly. In addition, metagenomic sequencing can detect the mutated sites in ARGs. To achieve better qPCR efficiencies, these mutated sites should be avoided in primer and probe design. Hundreds of ARGs may be found in metagenomic sequencing, but not all ARGs should be included in routine qPCR surveillance. This pipeline fills the gap between metagenomic sequencing and qPCR primer design for routine surveillance. With a drug list of interest and the ARG detection results from metagenomic sequencing, this pipeline generates qPCR primers and probes targeting the ARGs of most concern in the sample while avoiding the mutated sites.

## Package Requirements
### Python Packages  
* [Owlready2](https://github.com/pwin/owlready2)  
* [PyVCF](https://github.com/jamescasbon/PyVCF)  
### Bioinformatic Tools  
* [Samtools](https://www.htslib.org/) (v1.21 or above)  
* [FreeBayes](https://github.com/freebayes/freebayes)  
* [Bowtie2](https://github.com/BenLangmead/bowtie2) (or any other read mapping tool that can map fastq to a reference fasta file to generate a sam/bam file)
* [IGV](https://igv.org/)

## Usage
### Map fastq to fasta  
Here is an example using Bowtie2 to map paired fastq raw reads generated by Illumina sequencing to a fasta file containing all ARGs of interest. Users can use `ARG_with_NH8B.fasta` in this repository as the reference for ARG read mapping. These sequences were downloaded from [CARD](https://card.mcmaster.ca/), cleaned, and labeled by their AROs. Reading filtering before mapping using tools such as [PriceSeqFilter](https://derisilab.ucsf.edu/software/price/) is highly recommended. A more detailed read mapping protocol can be found in [our manuscript](https://www.biorxiv.org/content/10.1101/2024.07.30.605462v1.abstract).
```
bowtie2 -x [PATH_TO_REFERENCE_FASTA] -1 [PAIRED_FASTQ_FILE_1] -2 [PAIRED_FASTQ_FILE_2] -a --very-sensitive -S [OUTPUT_SAM_PATH]
```
### Convert .sam file to .bam file and get read coverage
Now we need to use Samtools to convert .sam file to .bam file.  
```
samtools view -Sb -o [OUTPUT_BAM_FILE_PATH] [INPUT_SAM_FILE_PATH]
```
The .bam file can be sorted and indexed to be viewable in [IGV](https://igv.org/).
```
samtools sort [INPUT_BAM_FILE_PATH] -o [OUTPUT_SORTED_BAM_FILE_PATH]
```
```
samtools index [SORTED_BAM_FILE_PATH]
```
Read coverage of each ARG can be summarized by samtools coverage using the sorted .bam file as input. Here, we use `-ff 0` to remove the restriction of secondary mapping.
```
samtools coverage â€“ff 0 -o [OUTPUT_COVERAGE_TSV_FILE_PATH]
```
An additional step to remove the secondary flags in the read mapping file.
```
samtools view --remove-flags 0x100 -b [INPUT_BAM_FILE] >[OUTPUT_CLEANED_BAM_FILE]
```
### Get mutated sites in all mapped ARGs
FreeBayes is used in this step to obtain the mutated sites in different ARGs detected in the given sample. A .vcf file will be generated to summarize all mutated sites.
```
freebayes -f [REFERENCE_FASTA_FILE] [CLEANED_BAM_FILE] >[OUTPUT_VCF_FILE]
```
### Obtain AROs for the drugs of interest
Not all ARGs are equal. Assume we are interested in detecting ARGs that confer resistance to a few commonly used drugs. The first step is to search for those drugs in the database. Here, we use [CARD](https://card.mcmaster.ca/) to search for antibiotics and ARGs. Assume we have a list of drugs (as listed in `example/Drug_name_example.txt`):  
![]()






